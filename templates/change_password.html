{% extends "base.html" %}

{% block title %}Change Password - BrokerPro{% endblock %}

{% block content %}
<section class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <div class="text-center">
            <i class="fas fa-lock text-4xl text-primary mb-4"></i>
            <h2 class="text-3xl font-bold text-gray-900">Change Password</h2>
            <p class="mt-2 text-gray-600">Update your account password</p>
        </div>
        
        <form class="mt-8 space-y-6" method="POST" id="changePasswordForm">
            <div class="space-y-4">
                <div>
                    <label for="current_password" class="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                    <input id="current_password" name="current_password" type="password" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="Enter your current password">
                </div>
                
                <div>
                    <label for="new_password" class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                    <input id="new_password" name="new_password" type="password" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="Enter your new password">
                    <div class="mt-2" id="passwordStrength">
                        <div class="text-xs text-gray-500 mb-1">Password strength:</div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="strengthBar" class="bg-red-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div id="strengthText" class="text-xs mt-1 text-gray-500">Enter a password</div>
                    </div>
                </div>
                
                <div>
                    <label for="confirm_password" class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                    <input id="confirm_password" name="confirm_password" type="password" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="Confirm your new password">
                    <div id="matchIndicator" class="text-xs mt-1"></div>
                </div>
            </div>

            <button type="submit" id="submitBtn"
                    class="w-full bg-primary hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                <i class="fas fa-key mr-2"></i>Change Password
            </button>
        </form>

        <div class="text-center mt-6">
            <a href="{{ url_for('dashboard.dashboard') }}" class="text-primary hover:text-blue-800 font-semibold transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
            </a>
        </div>
    </div>
</section>

<script>
    // Password strength indicator
    const newPasswordInput = document.getElementById('new_password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    const matchIndicator = document.getElementById('matchIndicator');
    const submitBtn = document.getElementById('submitBtn');

    function checkPasswordStrength(password) {
        let strength = 0;
        let feedback = [];

        if (password.length >= 8) strength += 1;
        else feedback.push('at least 8 characters');

        if (/[a-z]/.test(password)) strength += 1;
        else feedback.push('lowercase letters');

        if (/[A-Z]/.test(password)) strength += 1;
        else feedback.push('uppercase letters');

        if (/[0-9]/.test(password)) strength += 1;
        else feedback.push('numbers');

        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        else feedback.push('special characters');

        return { strength, feedback };
    }

    newPasswordInput.addEventListener('input', function() {
        const password = this.value;
        const { strength, feedback } = checkPasswordStrength(password);
        
        const percentage = (strength / 5) * 100;
        strengthBar.style.width = percentage + '%';
        
        if (strength < 2) {
            strengthBar.className = 'bg-red-500 h-2 rounded-full transition-all duration-300';
            strengthText.textContent = 'Weak - Add ' + feedback.slice(0, 2).join(', ');
            strengthText.className = 'text-xs mt-1 text-red-500';
        } else if (strength < 4) {
            strengthBar.className = 'bg-yellow-500 h-2 rounded-full transition-all duration-300';
            strengthText.textContent = 'Medium - Add ' + feedback.slice(0, 1).join(', ');
            strengthText.className = 'text-xs mt-1 text-yellow-500';
        } else {
            strengthBar.className = 'bg-green-500 h-2 rounded-full transition-all duration-300';
            strengthText.textContent = 'Strong password';
            strengthText.className = 'text-xs mt-1 text-green-500';
        }
        
        checkPasswordMatch();
    });

    confirmPasswordInput.addEventListener('input', checkPasswordMatch);

    function checkPasswordMatch() {
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        if (confirmPassword.length === 0) {
            matchIndicator.textContent = '';
            return;
        }
        
        if (newPassword === confirmPassword) {
            matchIndicator.textContent = 'Passwords match';
            matchIndicator.className = 'text-xs mt-1 text-green-500';
        } else {
            matchIndicator.textContent = 'Passwords do not match';
            matchIndicator.className = 'text-xs mt-1 text-red-500';
        }
    }
</script>
{% endblock %}